<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <delete id="stock_log_note_view_form" model="ir.ui.view"/>
        <record id="stock_prod_lot_view_form" model="ir.ui.view">
            <field name="name">Enhanced Stock Production Lot Form View for EMM</field>
            <field name="model">stock.production.lot</field>
            <field name="inherit_id" ref="product_serial.view_production_lot_form_unique_production_number" />
            <field name="arch" type="xml">
                <xpath expr="/form" position="inside">
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </xpath>
                <field name="name" position="replace">
                    <field name="name" readonly="1"/>
                </field>
                <field name="last_location_id" position="after">
                    <field name="barcode_printed" readonly="1"/>
                    <field name="utilized" readonly="1"/>
                </field>
                <field name="product_id" position="replace">
                    <field name="product_id" attrs="{'readonly':['|', ('utilized','=',True), ('name','!=','/')]}"/>
                </field>
                <field name="product_id" position="after">
                    <field name="company_id" required="1"/>
                </field>
            </field>
        </record>

        <record id="stock_prod_lot_view_tree" model="ir.ui.view">
            <field name="name">Enhanced Stock Production Lot Tree View for EMM</field>
            <field name="model">stock.production.lot</field>
            <field name="inherit_id" ref="stock.view_production_lot_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[last()]" position="after">
                    <field name="barcode_printed"/>
                    <field name="utilized"/>
                </xpath>
            </field>
        </record>

        <record id="stock_prod_lot_view_search" model="ir.ui.view">
            <field name="name">Enhanced Stock Production Lot Search View for EMM</field>
            <field name="model">stock.production.lot</field>
            <field name="inherit_id" ref="stock.search_product_lot_filter"/>
            <field name="arch" type="xml">
                <filter name="available" position="after">
                    <!-- icons to be replaced, though it wouldn't be relevant for 7.0 -->
                    <filter icon="terp-check" name="not_printed" string="Not Printed" domain="[('barcode_printed', '=', False)]" help="Barcode is not printed yet for this Serial Number."/>
                    <filter icon="terp-check" name="not_utilized" string="Not Utilized" domain="[('utilized', '=', False)]" help="Serial Number is not utilized yet."/>
                </filter>
            </field>
        </record>

        <menuitem action="stock.action_production_lot_form" id="menu_action_production_lot_form"
            parent="stock.menu_traceability" groups="stock.group_stock_user,stock.group_stock_manager,purchase.group_purchase_user,purchase.group_purchase_manager,purchase_requisition.group_purchase_requisition_user,purchase_requisition.group_purchase_requisition_manager,stock.group_production_lot"
            sequence="1"/>

        <!-- Old menu has to be deleted. Prevent duplicate menus.-->
        <delete model="ir.ui.menu" id="stock.menu_action_production_lot_form"/>

        <record id="view_move_picking_tree_internal_move_emm" model="ir.ui.view">
            <field name="name">stock.move.tree.internal.move.emm</field>
            <field name="model">stock.move</field>
            <field eval="4" name="priority"/>
            <field name="arch" type="xml">
                <tree colors="grey:scrapped == True" string="Stock Moves" editable="bottom">
                    <field name="product_id" on_change="onchange_product_id(product_id,location_id,location_dest_id, False)"/>
                    <field name="name" invisible="1"/>
                    <field name="product_qty" on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)"/>
                    <field name="product_uom" string="Unit of Measure" groups="product.group_uom"/>
                    <field name="product_uos" groups="product.group_uos"/>
                    <field name="picking_id" invisible="1"/>
                    <field name="create_date" invisible="1"/>
                    <field name="date_expected" invisible="1"/>
                    <button name="%(stock.move_scrap)d" string="Scrap Products" type="action" icon="terp-gtk-jump-to-ltr" context="{'scrap': True}" states="draft,waiting,confirmed,assigned" groups="base.group_user"/>
                    <field name="scrapped" invisible="1"/>
                    <field name="new_prodlot_code" groups="stock.group_production_lot" invisible="context.get('picking_type') != 'in' or False" />
                    <field name="prodlot_id" groups="stock.group_production_lot" context="{'location_id':location_id, 'product_id':product_id}" domain="[('product_id','=?',product_id)]" on_change="onchange_lot_id(prodlot_id, product_qty, location_id, product_id, product_uom)"/>
                    <button name="split_move" string="Manual Split"
                    groups="stock.group_production_lot"
                    states="draft,waiting,confirmed,assigned"
                    type="object" icon="gtk-justify-fill" />
                    <field name="new_tracking_code" groups="stock.group_tracking_lot" invisible="context.get('picking_type') != 'in' or False" />
                    <field groups="stock.group_tracking_lot" name="tracking_id"/>
                    <button name="setlast_tracking" string="Put in current pack" type="object" attrs="{'invisible': [('tracking_id','&lt;&gt;',False)]}" icon="terp-accessories-archiver" groups="stock.group_tracking_lot" states="draft,assigned,confirmed"/>
                    <button name="%(stock.split_into)d" string="Put in a new pack" type="action" groups="product.group_stock_packaging" icon="terp-accessories-archiver+" states="draft,assigned,confirmed"/>
                    <field name="product_packaging" groups="product.group_stock_packaging" domain="[('product_id','=',product_id)]" invisible="context.get('picking_type') != 'out' or False"/>
                    <field name="location_id" groups="stock.group_locations" domain="[('usage', '=', 'internal'), ('id', 'in', parent.source_loc_ids[0][2])]]"/>
                    <field name="location_dest_id" groups="stock.group_locations" domain="[('usage', '=', 'internal'), ('id', 'in', parent.dest_loc_ids[0][2])]]"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id='stock_move_notes' model='ir.ui.view'>
            <field name='name'>stock_move_notes</field>
            <field name='model'>stock.move</field>
            <field name='inherit_id' ref='stock.view_move_form' />
            <field name="arch" type="xml">
                <xpath expr="/form/sheet/group/group[@name='main_grp']/field[@name='name']" position="after">
                    <field name="note" string='Note' attrs="{'readonly': [('state', '=', 'done')]}"/>
                </xpath>
            </field>
        </record>

        <record id="emm_stock_picking_form_enhanced" model="ir.ui.view">
            <field name="name">Stock Picking Enhanced View for EMM</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="stock.view_picking_form" />
            <field name="arch" type="xml">
                <xpath expr="//form/header/button[@name='force_assign']" position="attributes">
                    <attribute name="groups">stock.group_stock_manager</attribute>
                </xpath>
                <field name="stock_journal_id" position="after">
                    <field name="source_warehouse" on_change="onchange_source_warehouse(source_warehouse, context)"/>
                    <field name="dest_warehouse" on_change="onchange_dest_warehouse(dest_warehouse, context)"/>
                    <field name="source_loc_ids" invisible="1"/>
                    <field name="dest_loc_ids" invisible="1"/>
                    <field name="source_loc_ids_default" invisible="1"/>
                    <field name="dest_loc_ids_default" invisible="1"/>
                </field>
                <field name="move_lines" position="attributes">
                    <attribute name="context">{'address_in_id': partner_id, 'form_view_ref':'stock.view_move_picking_form', 'tree_view_ref':'emm_stock_enhancements.view_move_picking_tree_internal_move_emm', 'picking_type': 'internal', 'source_loc_ids_default': source_loc_ids_default[0][2], 'dest_loc_ids_default': dest_loc_ids_default[0][2]}</attribute>
                </field>
            </field>
        </record>

        <record id="emm_stock_picking_out_form_enhanced" model="ir.ui.view">
            <field name="name">Stock Picking Out Enhanced View for EMM</field>
            <field name="model">stock.picking.out</field>
            <field name="inherit_id" ref="stock.view_picking_out_form" />
            <field name="arch" type="xml">
                <xpath expr="//form/header/button[@name='force_assign']" position="attributes">
                    <attribute name="groups">stock.group_stock_manager</attribute>
                </xpath>
                <xpath expr="//field[@name='name']/.." position="after">
                    <field name="ready_for_transfer"/>
                    <label for="ready_for_transfer"/>
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="phone"/>
                    <field name="mobile"/>
                </xpath>
                <xpath expr="//field[@name='origin']" position="after">
                    <field name="has_been_received"/>
                </xpath>
            </field>
        </record>

        <record id="emm_stock_picking_in_form_enhanced" model="ir.ui.view">
            <field name="name">Stock Picking In Enhanced View for EMM</field>
            <field name="model">stock.picking.in</field>
            <field name="inherit_id" ref="stock.view_picking_in_form" />
            <field name="arch" type="xml">
                <field name="invoice_state" position="after">
                    <field name="receive_ok" readonly="1"/>
                </field>
                <button name="draft_validate" position="attributes">
                    <attribute name="states"></attribute>
                    <attribute name="attrs">{'invisible': ['|', ('state', 'not in', ('draft')), ('receive_ok', '=', False)]}</attribute>
                </button>
                <button name="action_process" position="attributes">
                    <attribute name="states"></attribute>
                    <attribute name="attrs">{'invisible': ['|', ('state', 'not in', ('assigned')), ('receive_ok', '=', False)]}</attribute>
                </button>
            </field>
        </record>

        <record id="emm_stock_move_form_enhanced" model="ir.ui.view">
            <field name="name">Stock Move Enhanced View for EMM</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form/header/button[@name='force_assign']" position="attributes">
                    <attribute name="groups">stock.group_stock_manager</attribute>
                </xpath>
            </field>
        </record>

        <record id="emm_stock_picking_move_form_enhanced" model="ir.ui.view">
            <field name="name">Stock Picking Move Enhanced View for EMM</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_picking_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form/header/button[@name='force_assign']" position="attributes">
                    <attribute name="groups">stock.group_stock_manager</attribute>
                </xpath>
            </field>
        </record>

        <record id="emm_stock_picking_out_tree_enhanced" model="ir.ui.view">
            <field name="name">Stock Picking Out Enhanced Tree View for EMM</field>
            <field name="model">stock.picking.out</field>
            <field name="inherit_id" ref="stock.view_picking_out_tree" />
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']" position="after">
                    <field name="has_been_received"/>
                </xpath>
            </field>
        </record>
        <record id="emm_stock_picking_out_search_enhanced" model="ir.ui.view">
            <field name="name">Stock Picking Out Enhanced Search View for EMM</field>
            <field name="model">stock.picking.out</field>
            <field name="inherit_id" ref="stock.view_picking_out_search" />
            <field name="arch" type="xml">
                <xpath expr="//filter[@name='done']" position="after">
                    <filter icon="terp-accessories-archiver-minus" string="Unchecked" domain="[('has_been_received', '=', False)]" help="Is Product has been received by customer"/>
                </xpath>
            </field>
        </record>
    </data>
</openerp>
